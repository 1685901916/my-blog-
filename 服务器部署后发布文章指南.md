# 📚 服务器部署后发布文章指南

## 🚀 方案1：Git + 自动部署（最推荐）

### 工作流程
1. **本地修改** → 在本地编辑文章或修改配置
2. **提交代码** → `git add . && git commit -m "新增文章"`
3. **推送到远程** → `git push`
4. **服务器自动更新** → 通过 Git Hook 或 CI/CD 自动重新构建

### 服务器端配置

#### A. 使用 Git Hook（简单方案）

在服务器上创建一个自动部署脚本：

```bash
# 1. 在服务器项目目录创建更新脚本
cd /path/to/your/blog
nano auto-deploy.sh
```

```bash
#!/bin/bash
# auto-deploy.sh

echo "📥 拉取最新代码..."
git pull origin main

echo "📦 安装依赖..."
npm install

echo "🔨 构建项目..."
npm run build

echo "📋 复制到网站目录..."
rm -rf /var/www/html/blog/*
cp -r dist/* /var/www/html/blog/

echo "✅ 部署完成！"
```

```bash
# 2. 赋予执行权限
chmod +x auto-deploy.sh

# 3. 每次发布文章时，在服务器上运行
./auto-deploy.sh
```

#### B. 使用 GitHub Actions（自动化方案）

在项目中创建 `.github/workflows/deploy-to-server.yml`：

```yaml
name: Deploy to Server

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install dependencies
        run: npm install
      
      - name: Build
        run: npm run build
      
      - name: Deploy to Server
        uses: easingthemes/ssh-deploy@main
        env:
          SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
          REMOTE_HOST: ${{ secrets.REMOTE_HOST }}
          REMOTE_USER: ${{ secrets.REMOTE_USER }}
          SOURCE: "dist/"
          TARGET: "/var/www/html/blog/"
```

**优点**：
- ✅ 本地写文章，推送即部署
- ✅ 有版本控制，可以回滚
- ✅ 团队协作方便
- ✅ 完全自动化

---

## 🖥️ 方案2：直接在服务器上修改（不推荐）

### SSH 连接到服务器

```bash
ssh username@your-server-ip
```

### 进入项目目录

```bash
cd /path/to/your/blog
```

### 创建新文章

```bash
# 1. 进入 posts 目录
cd src/content/posts

# 2. 创建文章文件夹
mkdir my-new-article
cd my-new-article

# 3. 创建文章文件
nano index.md
```

### 编辑文章内容

```markdown
---
title: 我的新文章
published: 2025-11-03
description: 这是一篇新文章
tags: ["标签1", "标签2"]
category: 分类名
image: ""
draft: false
---

# 文章标题

文章内容...
```

### 修改配置

```bash
# 编辑配置文件
cd /path/to/your/blog
nano src/config.ts
```

### 重新构建和部署

```bash
# 1. 构建项目
npm run build

# 2. 复制到网站目录
rm -rf /var/www/html/blog/*
cp -r dist/* /var/www/html/blog/
```

**缺点**：
- ❌ 需要 SSH 操作，不方便
- ❌ 没有版本控制
- ❌ 容易出错
- ❌ 团队协作困难

---

## 📱 方案3：使用 CMS（内容管理系统）

可以集成第三方 CMS 来管理文章：

### 推荐的 CMS

1. **Decap CMS（原 Netlify CMS）**
   - 可视化编辑器
   - 直接提交到 Git
   - 免费开源

2. **Strapi**
   - 功能强大
   - API 驱动
   - 需要额外服务器

3. **Tina CMS**
   - 实时预览
   - Git 集成
   - 现代化界面

---

## 🎯 推荐工作流程

### 日常写作流程（方案1）

```bash
# 1. 本地创建文章
cd "D:\cursor\project8  blog\Mizuki-master"
mkdir "src/content/posts/我的新文章"
cd "src/content/posts/我的新文章"
echo "" > index.md

# 2. 编辑文章（使用你喜欢的编辑器）
code index.md  # 或者用其他编辑器

# 3. 本地预览
npm run dev

# 4. 提交并推送
git add .
git commit -m "新增：我的新文章"
git push

# 5. 服务器自动更新（如果配置了自动部署）
# 或者手动 SSH 到服务器运行 ./auto-deploy.sh
```

### 修改配置流程

```bash
# 1. 修改配置文件
src/config.ts
src/types/config.ts

# 2. 测试
npm run dev

# 3. 提交推送
git add .
git commit -m "更新：主页显示设置"
git push
```

---

## 🔧 快速部署脚本

创建一个本地快速部署脚本 `quick-deploy.bat`：

```batch
@echo off
echo 📝 开始部署...

echo.
echo 1️⃣ 提交更改到 Git...
git add .
set /p commit_msg="请输入提交信息: "
git commit -m "%commit_msg%"

echo.
echo 2️⃣ 推送到远程仓库...
git push

echo.
echo 3️⃣ SSH 到服务器并更新...
ssh username@your-server-ip "cd /path/to/your/blog && ./auto-deploy.sh"

echo.
echo ✅ 部署完成！
pause
```

使用方法：
- 双击运行 `quick-deploy.bat`
- 输入提交信息
- 自动推送并部署

---

## 📋 总结

| 方案 | 难度 | 效率 | 推荐度 |
|------|------|------|--------|
| Git + 自动部署 | ⭐⭐ | ⭐⭐⭐⭐⭐ | ✅ 强烈推荐 |
| 服务器直接修改 | ⭐⭐⭐ | ⭐⭐ | ❌ 不推荐 |
| CMS 系统 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ✅ 推荐 |

**最佳实践**：
1. ✅ 使用 Git 版本控制
2. ✅ 配置自动部署（GitHub Actions 或 Git Hook）
3. ✅ 本地写作，推送发布
4. ✅ 定期备份

这样你就可以在任何地方写文章，推送到 Git 后自动部署到服务器！

