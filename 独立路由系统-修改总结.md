# 独立路由系统实现 - 修改总结

## 目标
实现每个 content collection（posts、manga、portfolio）都有独立的文件路径，同时支持：
1. 独立文章和文件夹文章共存
2. 控制是否在主页显示
3. 正确的路由分离

## 已完成的修改

### 1. 修复 posts 路由 ✅
**文件：`src/pages/posts/[...slug].astro`**
- 第 23-32 行：改为只获取 `posts` collection
- 不再捕获 manga/portfolio 文章

### 2. 创建 manga 独立路由 ✅
**文件：`src/pages/manga/[...slug].astro`**
- 创建专门处理 manga collection 的路由页面
- 修复日期格式化（使用 `formatDateToYYYYMMDD`）
- 修复配置对象可选链（`siteConfig?.comment?.enable`）
- 路由：`/manga/[slug]/`

### 3. 更新 URL 工具函数 ✅
**文件：`src/utils/url-utils.ts`**
- 第 15-23 行：`getPostUrlBySlug(slug, collection)` 支持根据 collection 生成不同路径
  - `posts` → `/posts/[slug]/`
  - `manga` → `/manga/[slug]/`
  - `portfolio` → `/portfolio/[slug]/`

### 4. 更新主页组件 ✅
**文件：`src/components/PostPage.astro`**
- 第 25 行：传递 `entry.collection` 参数给 `getPostUrlBySlug`

### 5. 修复 manga 列表页 ✅
**文件：`src/pages/manga.astro`**
- 第 118 行：独立文章链接 `/posts/` → `/manga/`
- 第 184 行：封面图片链接 `/posts/` → `/manga/`
- 第 202 行：无封面按钮链接 `/posts/` → `/manga/`
- 现在同时显示文件夹和独立文章

## 路由结构

### 博客文章
- Collection: `src/content/posts/`
- 路由: `/posts/文章名/`
- 主页控制: `siteConfig.homepageContent.showBlogPosts`

### 漫画内容
1. **独立文章**
   - Collection: `src/content/manga/`
   - 路由: `/manga/文章名/`
   - 列表页: `/manga/` (显示所有独立文章和文件夹)
   
2. **文件夹文章**
   - 目录: `src/content/manga-categories/文件夹/`
   - 路由: `/manga/文件夹/文章名/`
   - 文件夹页: `/manga/文件夹/`

- 主页控制: `siteConfig.homepageContent.showMangaPosts`（只控制独立文章）

### 作品集
- Collection: `src/content/portfolio/`
- 路由: `/portfolio/文章名/`
- 主页控制: `siteConfig.homepageContent.showPortfolioPosts`

## 测试清单

✅ 主页点击 manga 文章 → `/manga/文章名/`
✅ `/manga/` 列表页显示文件夹 + 独立文章
✅ 点击独立文章 → `/manga/文章名/`
✅ 点击文件夹 → `/manga/文件夹/`
✅ 文件夹内文章 → `/manga/文件夹/文章名/`

## 当前文件状态

### 独立文章（会显示在主页和 /manga/）
- `src/content/manga/海贼王.md`
- `src/content/manga/火影忍者.md`（置顶）

### 文件夹文章（只显示在 /manga/文件夹/ 页面）
- `src/content/manga-categories/热血系列/海贼王.md`
- `src/content/manga-categories/热血系列/火影忍者.md`
- `src/content/manga-categories/推理系列/名侦探柯南.md`
- `src/content/manga-categories/推理系列/金田一少年事件簿.md`
- `src/content/manga-categories/日常系列/悠哉日常大王.md`
- `src/content/manga-categories/日常系列/阿松.md`

## 扩展到其他类型

将来添加 novel、anime 等类型时，只需：
1. 创建 `src/pages/类型/[...slug].astro`（复制 manga 的模板）
2. 在 `src/utils/url-utils.ts` 的 `getPostUrlBySlug` 中添加对应分支
3. 在 `src/config.ts` 中添加主页显示控制开关
4. 创建对应的 content collection

## 配置说明

在 `src/config.ts` 中：
```typescript
homepageContent: {
    showBlogPosts: true,      // 控制博客文章
    showMangaPosts: true,     // 控制漫画文章（只控制独立文章）
    showPortfolioPosts: true, // 控制作品集
}
```

- 设为 `true`：该类型文章会显示在主页
- 设为 `false`：该类型文章不显示在主页，但仍可通过专属页面访问









